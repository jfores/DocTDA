---
title: "DocTDA_vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DocTDA_vignette}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(DocTDA)
```

Download de structures of five proteins of the Globin family derived from five different species. 
The following commands could be used to download this structures directly from the Protein Data Bank. 
Note that we only need to provide a list of PDB identifiers to the function and a pathways to the storing folder to download them.
```{r,eval=FALSE}
globin_structures <- c("3RGK","1YMB","1MBO","1LHS","2NRL") #Select the structures you want to work with.
bio3d::get.pdb(globin_structures,path = "./Path_To_Folder" ) #Download the pdb files for each structure in the folder specified.
paths_to_str <- dir("./Path_To_Folder",full.names = T) #Create a vector with the absolute pathws to each downloaded structure.
structures <- read_multi_pdb(paths_to_str) #Reads all ped structures into R's environment.
```

Alternatively we will load the same structures stored as data in our package. We will extract the alpha carbon coordinates of each structure on the list. 

```{r}
data("structures") #load the globin strucutures.

class(structures$`1LHS`)

alpha_carbs <- extract_multiple_alpha(structures) #Produces a new list with the coordinates for the alpha carbons of the structures included in the previous list.
```

Compute max distances for each alpha carbon coordinate matrix.

```{r}
max_distances <- compute_max_d_multi(alpha_carbs)
```

Computing barcodes for the selected alpha carbon structures.

```{r}
barcodes_multi <- compute_homology_multi(alpha_carbs) #This function computes the barcodes for the 
```

You can also compute the barcode of an individual structure using this function.

```{r}
barcode_A <- compute_homology(alpha_carbs[[1]])

barcode_B <- compute_homology(alpha_carbs[[2]])

barcode_B_no_cero <- barcode_B[!barcode_B[,"dimension"] == 0,]

barcode_B_no_one <- barcode_B[!barcode_B[,"dimension"] == 1,]

barcode_B_no_two <- barcode_B[!barcode_B[,"dimension"] == 2,]

barcode_B_no_one_two <- barcode_B[!barcode_B[,"dimension"] %in% c(1,2),]

barcode_B_no_one_two_pseudo <- add_pseudo_barcode(barcode_B_no_one_two)

library(DocTDA)
help(add_pseudo_barcode)

as.factor(barcode_A[,"dimension"])

compute_sim_barcode_pair(barcode_A,barcode_A)

barcode_plot <- plot_barcodes(as.matrix(barcode_B_no_one_two_pseudo)
)

class(barcode_A)
as.matrix(barcode_B_no_one_two_pseudo)

dimensions_plot <- plot_dimensions(as.matrix(barcode_B_no_one_two_pseudo)
)

cowplot::plot_grid(barcode_plot,dimensions_plot)
dev.off()
```




```{r,eval=FALSE}
seq_to_compute <- seq(from = 0, to = max(barcode_individual[,2:3])+5,by = 0.1)
compute_pbf_for_curve(vec_vals = seq_to_compute,barcode = barcode_individual,dim_betti = 0)

#compute_pbf_for_curve()
```


```{r}
#pdb_temp <- read.pdb("/home/jj/Desktop/DrugBank/SpikeProteinTest/6vxx.pdb")
#pdb_temp$remark
#test_clean <- get_bio_clean(pdb_temp,"/home/jj/Desktop/","6vxx")
#warnings()
#data_test <- read.pdb("/home/jj/Desktop/6vxx_bio_1_clean.pdb")

pdbs <- dir("/home/jj/Desktop/DrugBank/PDBs/",full.names = T)
extract_and_clean_multi(pdbs,"/temp")
```

